<div class="banner padding70" style="background-image: linear-gradient(rgba(0,0,0,0.2),rgba(0,0,0,0.2)), url(https://images.squarespace-cdn.com/content/v1/54611b5be4b0b862de5ee550/1512054864812-11CEZK87IC6JVZCNY7AZ/ke17ZwdGBToddI8pDm48kCjOTWjA3bFR4FuIWmohiPUUqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYxCRW4BPu10St3TBAUQYVKcfKMZKyZMwQikGTdMFgsUh7IlmDMPfuq0zvntNEzrjTJg2dLV8np1-NrGJPalO4Hy/road+and+highways+banner.png?format=2500w);">
  <div class="container">
  <h1>Let's have a chat</h1>
  </div>
</div>

<div class="message-container">


  <div class= "message-title">
    <h2>Chat with your travel buddy</h2>

  </div>
  <div class="background_white-message m-3 p-3">
    <div class="container-message-top text-center mt-3">

      <% if current_user == @interaction.trip.user %>
        <% if @interaction.status == "pending" %>
          <%= simple_form_for @interaction, :url => interaction_path, :method => :patch do |f| %>
            <%= f.select :status, ["Validated", "Denied"], include_blank: 'Validate or deny the request', class: 'form-control' %>
            <%= f.submit "Answer to the buddy", class: "btn btn-flat-answer" %>
          <% end %>
        <% else %>
         Your trip is...
         <span class="highlight text-center"> <%= @interaction.status %> </span> !
        <% end %>

      <% else %>
        <% if @interaction.status == "active" %>
          <%= simple_form_for @interaction, :url => interaction_path, :method => :patch do |f| %>
            <%= f.select :status, ["asking for validation..."], include_blank: 'Select your status', class: 'form-control' %>
            <%= f.submit "Ask for validation", class: "btn btn-flat-answer" %>
          <% end %>
        <% else %>
          Your trip is...
         <span class="highlight text-center"> <%= @interaction.status %> </span> !
        <% end %>
      <% end %>
    </div>

    <div class="container-message-top text-center mt-3">
      <% if policy(@interaction).destroy? %>
        <%= link_to "Show my trip", trip_path(@interaction.trip), class: "btn btn-flat-return-trip text-center" %>

        <%= link_to "Abandon the trip", interaction_path(@interaction), method: :delete, data: {confirm: "Are you sure?"}, class: "btn btn-flat-abandon text-center" %>
      <% else %>
        <%= link_to "Show my trip", trip_path(@interaction.trip), class: "btn btn-flat-return-trip text-center" %>
      <% end %>
    </div>
  </div>


  <div class= "message-card">

    <div class="chatting-card">

      <h4 class="chatting-with">
        <% if current_user == @interaction.user %>
          You're chatting with <%= link_to " #{@interaction.trip.user.nickname}", profile_path(@interaction.trip.user.profile.id), class: "chatting-link"%>
        <% else %>
          You're chatting with <%= link_to " #{@interaction.user.nickname}", profile_path(@interaction.user.profile.id), class: "chatting-link"%>
        <% end %>
      </h4>

    </div>
    <div id='messages' data-interaction-id="<%= @interaction.id %>">
      <% @interaction.messages.each do |message| %>
        <% if message.user == current_user %>

          <div class="message-left">
            <i class="author-infos-left">
            <small><%= message.created_at.strftime("%l:%M%p") %></small>
            </i>
            <div class="avatar-message-left">
              <%= cl_image_tag message.user.profile.photo.key, class: "avatar-message", :transformation=>[ {:width=>30, :height=>30, :crop=>"thumb"}, {:radius=>50} ], id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
            </div>

              <p class="message-content" id="message-<%= message.id %>">
                <%= message.content %>
              </p>
          </div>

        <% else %>

          <div class="message-right">
            <i class="author-infos-right">
            <small><%= message.created_at.strftime("%l:%M%p") %></small>
            </i>
            <div class="avatar-message-right">
              <%= cl_image_tag message.user.profile.photo.key, class: "avatar-message", :transformation=>[ {:width=>30, :height=>30, :crop=>"thumb"}, {:radius=>50} ], id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
            </div>
              <p class="message-content" id="message-<%= message.id %>">
                <%= message.content %>
              </p>
          </div>
        <% end %>
      <% end  %>
      <div class="typing-message">
        <%= simple_form_for [@interaction, @message], remote: true do |f| %>
          <%= f.input :content, label: false, placeholder: "Write your message..." %>
        <% end %>
      </div>
    </div>
  </div>
</div>

