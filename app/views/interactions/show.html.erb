<div class="banner padding70" style="background-image: linear-gradient(rgba(0,0,0,0.2),rgba(0,0,0,0.2)), url(https://images.squarespace-cdn.com/content/v1/54611b5be4b0b862de5ee550/1512054864812-11CEZK87IC6JVZCNY7AZ/ke17ZwdGBToddI8pDm48kCjOTWjA3bFR4FuIWmohiPUUqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYxCRW4BPu10St3TBAUQYVKcfKMZKyZMwQikGTdMFgsUh7IlmDMPfuq0zvntNEzrjTJg2dLV8np1-NrGJPalO4Hy/road+and+highways+banner.png?format=2500w);">
  <div class="container">
  <h1>Discuss with your travel buddy</h1>
  </div>
</div>



<div class="container">


  <h2>Chat with your travel buddy</h2>

  <% if current_user == @interaction.user %>
    <%= link_to "You're chatting with #{@interaction.trip.user.nickname}", profile_path(@interaction.trip.user.profile.id)%>
  <% else %>
    <%= link_to "You're chatting with #{@interaction.user.nickname}", profile_path(@interaction.user.profile.id)%>
  <% end %>

  <div id='messages' data-interaction-id="<%= @interaction.id %>">
    <% @interaction.messages.each do |message| %>
      <%= render 'messages/message', message: message %>
    <% end %>
  </div>


  <%= simple_form_for [@interaction, @message], remote: true do |f| %>
    <%= f.input :content, label: false, placeholder: "Message" %>
  <% end %>


<div>
  <% if current_user == @interaction.trip.user %>
    <% if @interaction.status == "pending" %>
      <%= simple_form_for @interaction, :url => interaction_path, :method => :patch do |f| %>
        <%= f.select :status, ["Validated", "Denied"], include_blank: 'Validate or deny the request', class: 'form-control' %>
        <%= f.submit "Answer to the buddy", class: "btn btn-primary" %>
      <% end %>
    <% else %>
      <%= @interaction.status %>
    <% end %>


  <% else %>
    <% if @interaction.status == "active" %>
      <%= simple_form_for @interaction, :url => interaction_path, :method => :patch do |f| %>
        <%= f.select :status, ["asking for validation..."], include_blank: 'Select your status', class: 'form-control' %>
        <%= f.submit "Ask for validation", class: "btn btn-primary" %>
      <% end %>
    <% else %>
      <%= @interaction.status %>
    <% end %>
  <% end %>
</div>


  <div class="container-infos text-center">
    <% if policy(@interaction).destroy? %>
      <%= link_to "Abandon the trip", interaction_path(@interaction), method: :delete, data: {confirm: "Are you sure?"}, class: "btn-round-corners" %>
    <% end %>
  </div>
</div>

